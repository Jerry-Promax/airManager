<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.airticketmanager.mapper.AdminOrderMapper">

    <resultMap id="OrderResultMap" type="com.example.airticketmanager.entity.Order">
        <!-- 主表orders的字段映射 -->
        <id property="orderId" column="order_id"/>
        <result property="uid" column="user_id"/>
        <result property="fid" column="flight_id"/>
        <result property="orderStatus" column="order_status"/>
        <result property="seatNumber" column="seat_number"/>
        <result property="orderTime" column="order_time"/>
        <result property="price" column="price"/>

        <!-- 关联User对象 -->
        <association property="user" javaType="com.example.airticketmanager.entity.User">
            <id property="userId" column="user_id"/>
            <result property="name" column="name"/>
            <result property="idCard" column="id_card"/>
            <result property="tel" column="tel"/>
        </association>

        <!-- 关联Flight对象-->
        <association property="flight" javaType="com.example.airticketmanager.entity.Flight">
            <id property="flightId" column="flight_id"/> <!-- 必须包含Flight的主键 -->
            <result property="flightNumber" column="flight_number"/>
        </association>
    </resultMap>

    <!-- 分页查询订单 -->
    <select id="selectOrdersByPage" resultMap="OrderResultMap">
        SELECT
            o.*,
            u.name,
            u.id_card,
            u.tel,
            f.flight_number
        FROM orders o
                 LEFT JOIN user u ON o.user_id = u.user_id
                 LEFT JOIN flights f ON o.flight_id = f.flight_id
            LIMIT #{limit} OFFSET #{offset}
    </select>
</mapper>